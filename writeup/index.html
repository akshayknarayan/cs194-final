<!DOCTYPE html>
<html>
    <head>
        <title>CS194-26 Final Project | Japheth Wong and Akshay Narayan</title>
        <style type="text/css">
            body {
                font-family: tahoma;
                font-size: 12px;
                background: #eee;
                color: black;
                margin: 0px;

            }

            #container {
                margin: 0px auto;
                padding: 20px 50px 50px 50px;
                width: 900px;
                background: white;
            }

            h1 {
                font-size: 24px;
                clear: both;
            }

            h2 {
                font-size: 18px;
                color: #676767;
                clear: both;
            }

            h3 {
                font-size: 13px;
                color: #999;
                font-weight: bold;
                text-transform: uppercase;
            }

            a {
                color: #0D4875;
            }

            a:hover {
                color: #389CDC;
            }

            td {
                padding: 5px 5px;
                vertical-align: top;
            }

            td:first-child {
                padding-left: 0;
            }

            p, b, td {
                font-size: 12px;
            }

            ul.nav {
                list-style-image: url(images/RightArrow.gif);
                list-style-position:inside;
                padding-left: 0;
            }

            ul.nav li {
                line-height:18px;
            }

            ul li p, ol li p {
                margin: 4px 0px;
            }

            a.back_to_top {
                font-size:10px;
                clear:both;
            }

            *.code {
                font-family: courier;
            }

            h3 + table {
                margin-top: -8px;
            }

            h3 + table p, p + table p {
                margin-top: 0px;
            }

            .code {
                font-family: "courier";
            }

            table {
                width: 900px;
            }

            table.results img {
                max-width: 290px;
                height: auto;
            }

            table.results tr:first-child p, table.results tr td:first-child p {
                text-decoration: underline;
            }

        </style>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <div id="container">
            <h1 id="top">CS194-26 Final Project</h1>
            <p><b>Japheth Wong (cs194-fb) and Akshay Narayan (cs194-ka)</b> | University of California, Berkeley | Prof. Alexei (Alyosha) Efros</p>

            <h2 id="nav">Navigation</h2>
            <table>
                <tr>
                    <td>
                        <b><a href="#hdr">High Dynamic Range</a></b>
                        <ul class="nav">
                            <li><a href="#hdr_overview">Project Overview</a></li>
                            <li><a href="#hdr_algorithm">Algorithm</a></li>
                            <li><a href="#hdr_results">Results</a></li>
                            <li><a href="#hdr_references">References</a></li>
                        </ul>
                    </td>
                    <td>
                        <b><a href="#miniatures">Fake Miniatures</a></b>
                        <ul class="nav">
                            <li><a href="#miniatures_overview">Project Overview</a></li>
                            <li><a href="#miniatures_algorithm">Algorithm</a></li>
                            <li><a href="#miniatures_results">Results</a></li>
                        </ul>
                    </td>
                    <td>
                        <b><a href="#vertigo">Vertigo Shots</a></b>
                        <ul class="nav">
                            <li><a href="#vertigo_overview">Project Overview</a></li>
                            <li><a href="#vertigo_technique">Technique</a></li>
                            <li><a href="#vertigo_results">Results</a></li>
                        </ul>
                    </td>
                </tr>
            </table>

            <div id="hdr">
                <h1>High Dynamic Range</h1>

                <h2 id="hdr_overview">Project Overview</h2>

                <p>Often times, photographers wish to capture and portray scenes in the real world which have high dynamic range.  Modern cameras, however, are unable to capture this range: these devices struggle to map this range to one of 256 intensity values in each color channel.  This means that in some scenes, even the best photographs will be partially over- or under-exposed.</p>

                <p>One solution for photographers is to take multiple exposures of the same scene by varying the shutter speed.  These exposures will vary in the parts which are optimally exposed, and can be combined together to form a single result which better reflects the high-dynamic-range scene.  This project is about recovering the radiance map from multiple exposures and using tone mapping to create the final, displayable result.</p>

                <a href="#top" class="back_to_top">Back to Top</a>

                <h2 id="hdr_algorithm">Algorithm</h2>

                <p>The algorithm can be broken down into two major parts:</p>
                <ol>
                    <li><p><b>Recovering the radiance map.</b>  The focus here is on taking the exposure values from each of the individual images, translating these curves, and recovering a single, smooth curve which represents the radiance map of the image.  This radiance map, however, is still not displayable by current devices.</p></li>
                    <li><p><b>Tone mapping.</b>  The focus here is on taking the radiance map and mapping it to intensity values between 0 and 256 in order to create an image that can be displayed.</p></li>
                </ol>

                <h3>Recovering the Radiance Map</h3>

                <p>The value of the \(i\)th pixel in the \(j\)th exposure is a function of (unknown) irradiances and (known) exposure times.  In equation form:

                $$Z_{ij} = f(E_{i} \Delta t_{j})$$

                In practice, it is easier to define a camera response function \(g = \ln f^{-1}\) and to solve for the following equation instead, which will be useful in recovering the radiance map:

                $$g(Z_{ij}) = \ln(f^{-1}(Z_{ij})) = \ln(E_{i}) + \ln(\Delta t_{j})$$
                </p>

                <p><b>Image Sampling</b></p>

                <p>We begin by reading in all of the images in the directory and recording the log of the associated exposure times.  One initial tradeoff we must make is the number of pixels to use in our sample: we want to ensure we have enough pixels to broadly cover the entire range of pixel values, but also want to minimize the sample size to improve performance.  Let \(N\) represent the number of pixels we will sample, \(P\) be the number of exposures (images) we have to work with, and \(Z_{min}\) and \(Z_{max}\) represent the minimum and maximum pixel values in our image.  Then, we use the constraint specified by Debevec 1997 to determine the number of sample points we need:

                $$N(P-1) \gt Z_{max} - Z_{min} \Rightarrow N = 2 \lceil \frac{(Z_{max} - Z_{min})}{P-1} \rceil$$

                The same pixels in the sample are selected from each exposure, and are used to help solve for the camera response.</p>

                <p><b>Computing Weights</b></p>

                <p>We expect the camera response to fit the data more poorly at the extremes, so it is important to emphasize the fitting on the center part of the curve.  As such, we use a simple weighting scheme which peaks at the midpoint pixel value.

                $$  w(z) = \begin{cases}
                           z - Z_{min} &  z \leq \frac{1}{2}(Z_{max} - Z_{min}) \\
                           Z_{max} - z &  z \gt \frac{1}{2}(Z_{max} - Z_{min}) 
                           \end{cases} $$

                <p><b>Compute the Camera Response</b></p>

                <p>Using these components, we can solve for the camera response.  Because this is an overdetermined system, we wish to minimize the following objective function, which consists of a fitting term (left component) and a smoothing term (right component):

                $$ O = \sum_{i=1}^{N} \sum_{j=1}^{P} {w(Z_{ij}) [g(Z_{ij} - \ln E_{i} - \ln \Delta t_{j})]}^{2} + \lambda \sum_{z=Z_{min}+1}^{Z_{max}-1}[w(z) g''(z)]^{2}$$
                
                This can be done using the <span class="code">gsolve.m</span> provided in the <a href="http://www.pauldebevec.com/Research/HDR/debevec-siggraph97.pdf">Debevec 1997</a> paper.
                </p>

                <p><b>Compute the HDR Radiance Map</b></p>

                <p>Once we have this information, we can finally compute the radiance map.  The equation we follow for the log of the radiance is as follows:

                $$\ln E_{i} = \frac{\sum_{j=1}^{P} w(Z_{ij})[g(Z_{ij} - \ln \Delta t_{j})]}{\sum_{j=1}^{P} w_(Z_{ij})}$$

                </p>

                <h3>Tone Mapping</h3>

                <a href="#top" class="back_to_top">Back to Top</a>

                <h2 id="hdr_results">Results</h2>

                <a href="#top" class="back_to_top">Back to Top</a>

                <h2 id="hdr_references">References</h2>

                <a href="#top" class="back_to_top">Back to Top</a>
            </div>

            <div id="miniatures">
                <h1>Fake Miniatures</h1>

                <h2 id="miniatures_overview">Project Overview</h2>

                <a href="#top" class="back_to_top">Back to Top</a>

                <h2 id="miniatures_algorithm">Algorithm</h2>

                <a href="#top" class="back_to_top">Back to Top</a>

                <h2 id="miniatures_results">Results</h2>

                <a href="#top" class="back_to_top">Back to Top</a>
            </div>

            <div id="vertigo">
                <h1>Vertigo Shots</h1>

                <h2 id="vertigo_overview">Project Overview</h2>

                <a href="#top" class="back_to_top">Back to Top</a>

                <h2 id="vertigo_technique">Technique</h2>

                <a href="#top" class="back_to_top">Back to Top</a>

                <h2 id="vertigo_results">Results</h2>

                <a href="#top" class="back_to_top">Back to Top</a>
            </div>
        </div>
    </body>
</html>
